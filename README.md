<div align="center">
  <img src="./assets/simple-python-template-logo.jpeg" width="200">
</div><p>

<div align="center">

# Simple Python Template

### Compatibility and Version
<img src="https://img.shields.io/badge/%3E=python-3.8-blue.svg" alt="Python compat">
<a href="https://pypi.python.org/pypi/GIT_REPONAME"><img src="https://img.shields.io/pypi/v/GIT_REPONAME.svg" alt="PyPi"></a>

### CI/CD
<a href="https://github.com/GIT_USERNAME/GIT_REPONAME/actions?query=workflow%3Atests"><img src="https://github.com/GIT_USERNAME/GIT_REPONAME/actions/workflows/tests.yaml/badge.svg?branch=main" alt="GHA Status"></a>
<a href="https://codecov.io/github/GIT_USERNAME/GIT_REPONAME?branch=main"><img src="https://codecov.io/github/GIT_USERNAME/GIT_REPONAME/coverage.svg?branch=main" alt="Coverage"></a>

### Documentation
<a href="https://GIT_REPONAME.readthedocs.io/en/latest/?badge=latest"><img src="https://readthedocs.org/projects/GIT_REPONAME/badge/?version=latest" alt="Documentation Status"></a>

### License and Issues
<a href="https://github.com/GIT_USERNAME/GIT_REPONAME/blob/main/LICENSE"><img src="https://img.shields.io/github/license/GIT_USERNAME/GIT_REPONAME" alt="License"></a>
<a href="https://github.com/GIT_USERNAME/GIT_REPONAME/issues"><img src="https://img.shields.io/github/issues/GIT_USERNAME/GIT_REPONAME" alt="Issues"></a>
<a href="https://github.com/GIT_USERNAME/GIT_REPONAME/issues?q=is%3Aissue+is%3Aclosed"><img src="https://img.shields.io/github/issues-closed/GIT_USERNAME/GIT_REPONAME" alt="Closed Issues"></a>
<a href="https://github.com/GIT_USERNAME/GIT_REPONAME/issues?q=is%3Aissue+is%3Aopen"><img src="https://img.shields.io/github/issues-raw/GIT_USERNAME/GIT_REPONAME" alt="Open Issues"></a>

### Community and Social
<a href="https://twitter.com/intent/follow?screen_name=GIT_USERNAME"><img src="https://img.shields.io/twitter/follow/GIT_USERNAME" alt="Twitter Follow"></a>
<a href="https://gitter.im/GIT_REPONAME/community?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge"><img src="https://badges.gitter.im/GIT_REPONAME/community.svg" alt="Gitter"></a>
<a href="https://matrix.to/#/!GIT_REPONAME:matrix.org"><img src="https://img.shields.io/matrix/GIT_REPONAME" alt="Matrix"></a>
<a href="https://discord.gg/GIT_REPONAME"><img src="https://img.shields.io/discord/GIT_REPONAME" alt="Discord"></a>

### Development and Quality
<a href="https://github.com/GIT_USERNAME/GIT_REPONAME/network/members"><img src="https://img.shields.io/github/forks/GIT_USERNAME/GIT_REPONAME" alt="Forks"></a>
<a href="https://github.com/GIT_USERNAME/GIT_REPONAME/stargazers"><img src="https://img.shields.io/github/stars/GIT_USERNAME/GIT_REPONAME" alt="Stars"></a>
<a href="https://pypi.python.org/pypi/GIT_REPONAME"><img src="https://img.shields.io/pypi/dm/GIT_REPONAME" alt="Downloads"></a>
<a href="https://github.com/GIT_USERNAME/GIT_REPONAME/graphs/contributors"><img src="https://img.shields.io/github/contributors/GIT_USERNAME/GIT_REPONAME" alt="Contributors"></a>
<a href="https://github.com/GIT_USERNAME/GIT_REPONAME/commits/main"><img src="https://img.shields.io/github/commit-activity/m/GIT_USERNAME/GIT_REPONAME" alt="Commits"></a>
<a href="https://github.com/GIT_USERNAME/GIT_REPONAME/commits/main"><img src="https://img.shields.io/github/last-commit/GIT_USERNAME/GIT_REPONAME" alt="Last Commit"></a>
<a href="https://github.com/GIT_USERNAME/GIT_REPONAME"><img src="https://img.shields.io/github/languages/code-size/GIT_USERNAME/GIT_REPONAME" alt="Code Size"></a>
<a href="https://github.com/GIT_USERNAME/GIT_REPONAME"><img src="https://img.shields.io/github/repo-size/GIT_USERNAME/GIT_REPONAME" alt="Repo Size"></a>
<a href="https://github.com/GIT_USERNAME/GIT_REPONAME/watchers"><img src="https://img.shields.io/github/watchers/GIT_USERNAME/GIT_REPONAME" alt="Watchers"></a>
<a href="https://github.com/GIT_USERNAME/GIT_REPONAME"><img src="https://img.shields.io/github/commit-activity/y/GIT_USERNAME/GIT_REPONAME" alt="Activity"></a>
<a href="https://github.com/GIT_USERNAME/GIT_REPONAME/pulls"><img src="https://img.shields.io/github/issues-pr/GIT_USERNAME/GIT_REPONAME" alt="PRs"></a>
<a href="https://github.com/GIT_USERNAME/GIT_REPONAME/pulls?q=is%3Apr+is%3Aclosed"><img src="https://img.shields.io/github/issues-pr-closed/GIT_USERNAME/GIT_REPONAME" alt="Merged PRs"></a>
<a href="https://github.com/GIT_USERNAME/GIT_REPONAME/pulls?q=is%3Apr+is%3Aopen"><img src="https://img.shields.io/github/issues-pr/open/GIT_USERNAME/GIT_REPONAME" alt="Open PRs"></a>

### Funding
<a href="https://www.patreon.com/GIT_USERNAME"><img src="https://img.shields.io/badge/donate-patreon-F96854.svg" alt="Patreon"></a>
<a href="https://ko-fi.com/GIT_USERNAME"><img src="https://img.shields.io/badge/donate-ko--fi-29ABE0.svg" alt="Ko-Fi"></a>
<a href="https://opencollective.com/GIT_REPONAME"><img src="https://img.shields.io/badge/donate-open%20collective-1D6DFF.svg" alt="Open Collective"></a>
<a href="https://saythanks.io/to/GIT_USERNAME"><img src="https://img.shields.io/badge/say-thanks-1EAEDB.svg" alt="Say Thanks"></a>
<a href="https://www.buymeacoffee.com/GIT_USERNAME"><img src="https://img.shields.io/badge/donate-buy%20me%20a%20coffee-FF813F.svg" alt="Buy Me A Coffee"></a>

### Best Practices and Quality Assurance
<a href="https://bestpractices.coreinfrastructure.org/projects/4578"><img src="https://bestpractices.coreinfrastructure.org/projects/4578/badge" alt="CII Best Practices"></a>
<a href="https://codebeat.co/projects/github-com-GIT_USERNAME-GIT_REPONAME-main"><img src="https://codebeat.co/badges/GIT_REPONAME" alt="Codebeat"></a>
<a href="https://waffle.io/GIT_USERNAME/GIT_REPONAME"><img src="https://badge.waffle.io/GIT_USERNAME/GIT_REPONAME.svg?columns=all" alt="Waffle.io - Columns and their card count"></a>
<a href="https://snyk.io/test/github/GIT_USERNAME/GIT_REPONAME"><img src="https://img.shields.io/snyk/vulnerabilities/github/GIT_USERNAME/GIT_REPONAME.svg" alt="Snyk Vulnerabilities"></a>
<a href="https://app.codacy.com/project/GIT_USERNAME/GIT_REPONAME/dashboard"><img src="https://img.shields.io/codacy/coverage/GIT_REPONAME.svg" alt="Codacy coverage"></a>
<a href="https://bettercodehub.com/"><img src="https://bettercodehub.com/edge/badge/GIT_USERNAME/GIT_REPONAME?branch=main" alt="BCH compliance"></a>
<a href="https://scrutinizer-ci.com/g/GIT_USERNAME/GIT_REPONAME/?branch=main"><img src="https://scrutinizer-ci.com/g/GIT_USERNAME/GIT_REPONAME/badges/quality-score.png?b=main" alt="Scrutinizer"></a>

</div>

# Table of Contents

- [Features](#Features)
- [Installation](#installation)
- [Commands](#commands)
- [Usage](#usage)
- [Todos](#todos)

---

# Simple Python Template

This template was bootstrapped with [BrianPugn's Python Template](https://github.com/BrianPugh/python-template).

The **Simple Python Template** is a robust and flexible starting point for Python projects, specifically designed to address the challenges faced by developers writing C-Python extensions. It showcases as an example to these:

1. Building pure C extension modules to Python.
2. Building C extension modules to Python with transpilation provided by Cython.
3. (In the near future) Vendoring another C library for building C extension modules in Python.

With a comprehensive `build.py` script included, this template simplifies the building of Python extension modules, whether you're using pure C or leveraging Cython for enhanced performance and ease of use. The `build.py` script automates the compilation and linking of C code, handling dependencies and configurations seamlessly. This allows you to focus on writing your extension logic rather than wrestling with build configurations.

# Table of Contents

- [Features](#features)
- [List of Tools Used](#list-of-tools-used)
- [List of Tools Used for Python](#list-of-tools-used-for-python)
- [How to Use](#how-to-use)
   - [Definitions](#definitions)
   - [How to Start](#how-to-start)
- [Convenient Scripts](#convenient-scripts)
- [Testing with Docker](#testing-with-docker)

# Features
Modular Design: Easily extendable with modular components.

Testing Integration: Built-in support for unit and integration tests.

Documentation: Auto-generated documentation using Read the Docs.

Continuous Integration: Configured for GitHub Actions.

Code Quality: Integrated with Code Climate, Codacy, and Snyk for code quality and security.

Coverage Tracking: Coverage tracking with Codecov.

# List of Tools Used

This list of tools are opinionated, feel free to remove any by not installing it.

| Name          | Description                                                                                     | Website                                      |
|---------------|-------------------------------------------------------------------------------------------------|----------------------------------------------|
| Chocolatey    | A package manager for Windows used to install software like make, cppcheck, and clang-format. | [Chocolatey](https://chocolatey.org/)       |
| Make          | A build automation tool that is checked for installation and installed if not present.        | [Make](https://www.gnu.org/software/make/) |
| Python        | The script checks for various versions of Python (specifically python3.9 and above) and installs pip if it is not already installed. | [Python](https://www.python.org/)           |
| Pip           | The package installer for Python, which is installed if not found.                             | [Pip](https://pip.pypa.io/en/stable/)      |
| Pre-commit    | A framework for managing and maintaining multi-language pre-commit hooks.                     | [Pre-commit](https://pre-commit.com/)      |
| Cppcheck      | A static analysis tool for C/C++ code, which is checked for installation and installed if not present. | [Cppcheck](http://cppcheck.sourceforge.net/) |
| Clang-format  | A tool to format C/C++ code, which is also checked for installation and installed if not present. | [Clang-format](https://clang.llvm.org/docs/ClangFormat.html) |
| Curl          | A command-line tool for transferring data with URLs, used to download the get-pip.py script. | [Curl](https://curl.se/)                    |
| Sed           | A stream editor used for parsing and transforming text, specifically for renaming package instances in files. | [Sed](https://www.gnu.org/software/sed/)   |
| Bash          | The scripting language used to write the entire script.                                       | [Bash](https://www.gnu.org/software/bash/)  |
|Pyenv| It is a simple Python version management tool that allows you to easily switch between multiple versions of Python. It helps manage different Python environments for different projects seamlessly. | [Pyenv](https://github.com/pyenv/pyenv?tab=readme-ov-file#set-up-your-shell-environment-for-pyenv) |

# List of Tools Used for Python

This list of tools are opinionated, feel free to remove any by removing its occurrences in the [`pyproject.toml`](./pyproject.toml) file.

| Name        | Description                                                                                     | Website                                      |
|-------------|-------------------------------------------------------------------------------------------------|----------------------------------------------|
| Poetry      | A dependency management and packaging tool for Python projects.                                | [Poetry](https://python-poetry.org/)        |
| Sphinx      | A documentation generator for Python projects.                                                | [Sphinx](https://www.sphinx-doc.org/)       |
| GitPython   | A Python library used to interact with Git repositories.                                      | [GitPython](https://gitpython.readthedocs.io/) |
| Pre-commit  | A framework for managing and maintaining multi-language pre-commit hooks.                     | [Pre-commit](https://pre-commit.com/)      |
| Coverage    | A tool for measuring code coverage of Python programs.                                        | [Coverage.py](https://coverage.readthedocs.io/) |
| Pytest      | A testing framework for Python that makes it easy to write simple and scalable test cases.    | [Pytest](https://pytest.org/)               |
| Ruff        | A fast Python linter that checks for style and programming errors.                             | [Ruff](https://ruff.rs/)                    |
| Mypy        | An optional static type checker for Python.                                                   | [Mypy](http://mypy-lang.org/)               |
| Cython      | A programming language that makes writing C extensions for Python as easy as Python itself.   | [Cython](https://cython.org/)               |
| Isort       | A Python utility for sorting imports.                                                          | [Isort](https://pycqa.github.io/isort/)    |
| Time-machine| A library for manipulating time in tests.                                                     | [Time-machine](https://pypi.org/project/time-machine/) |
| Nbconvert   | A tool for converting Jupyter Notebooks to other formats.                                     | [Nbconvert](https://nbconvert.readthedocs.io/) |
| Twine       | A utility for publishing Python packages on PyPI.                                             | [Twine](https://twine.readthedocs.io/)     |
| Black       | A code formatter for Python that enforces a consistent coding style.                           | [Black](https://black.readthedocs.io/)     |
| Flake8      | A tool for enforcing coding style in Python, combining PyFlakes, pycodestyle, and McCabe complexity checker. | [Flake8](https://flake8.pycqa.org/)        |
| Codespell   | A tool for checking and correcting common misspellings in text files.                         | [Codespell](https://github.com/codespell-project/codespell) |
| Creosote    | A tool for managing Python virtual environments.                                               | [Creosote](https://creosote.readthedocs.io/) |
| Pyright     | A static type checker for Python, providing type checking and type inference.                  | [Pyright](https://github.com/microsoft/pyright) |


# How To Use

## Definitions

|Term|Definitions|Name in this Repository|
|:---:|:---:|:---:|
|`ROOT_DIR`|The directory where the file [`pyproject.toml`](./pyproject.toml) resides|`simple-python-template`|
|`SOURCE_DIR`|The directory where the source files (i.e. files that contain your code) are located.|`simple_python_template`|
|`BUILD_DIR`|The directory where built distributions (e.g., source distributions and wheels) are stored after running the build command. This is typically the `dist` directory created by tools like Poetry.|`build`|
|`TESTS_DIR`|The directory where your test files are located. This is where you will place your test cases to ensure your code functions as expected. Typically, this directory contains files that start with `test_` or end with `_test.py`.|`tests`|

## How to Start

0. Decide on a Minimally Supported Python Version (MSPV), e.g. Python 3.8.
This is because, once you have determined a MSPV, it is easier to code in a Virtual Environment with that Python Version and because of Python's Backward Compatibility Guarantee, you can be ensured that your codes will run in higher Python versions.

1. Run `init.sh`
If you're on Windows, you should download Git bash.

```bash
bash init.sh
```

This command will attempt to install the necessary tools. And it will ask if you want to change the value of the name placeholders, e.g. `AUTHOR_NAME` to your name, etc.

2. Create a Python virtual environment

```bash
python -m venv .venv
```

A new folder named .venv will be created.

Make sure you use the Python executable with the MSPV, e.g. if you had chosen Python 3.8 to be the MSPV, then you should do:

```bash
python3.8 -m venv .venv
```

You can also use the customized script, [`scripts/create_venv.sh`](./scripts/create_venv.sh) to help you. Run:

```bash
bash scripts/create_venv.sh
```

3. Activate the virtual environment
On macOS/Linux:

```bash
source .venv/bin/activate
```

On Windows:
```bash
.\.venv\Scripts\activate
```

4. Configure Poetry to use the virtual environment
```bash
poetry config virtualenvs.in-project true
```

This command ensures that Poetry uses the `.venv` folder created in your project directory.

5. Build the package with Poetry

```bash
poetry build
```

This will create a source distribution (a tar file usually) and a wheel (a `.whl` file) in the `dist` directory.

6. Run tests with coverage

To run tests with coverage, use:
```bash
python -m pytest --cov=your_package_name tests
```
Replace `your_package_name` with the name of your package.

7. Run tests without coverage

To run tests without coverage, simply use:
```bash
python -m pytest tests
```
This will execute all tests located in the tests directory.

8. Format your codes using `Ruff` and `clang-format`.

Command:

```bash
make format
```

It has been configured within the `Makefile` to help you format your codes.

# Convenient Scripts

The scripts are located in the [./scripts](./scripts/) folder.

## quick_tests.sh

To quickly install the package and run tests, you can use the provided `install_and_test.sh` script. This script performs the following steps:

1. **Finds the Largest Version**: It searches for the largest version of the package in the `./dist` directory.

2. **Builds the Package if Not Found**: If no package is found, it attempts to build the package using `poetry build`.

3. **Checks for Existing Installation**: Before installing the package, it checks if the package is already installed using `pip show`.

4. **Uninstalls Existing Package**: If the package is found to be installed, it uninstalls it using `pip uninstall -y`.

5. **Installs the Largest Version**: It installs the largest version found in the `./dist` directory.

6. **Runs Tests**: Finally, it runs the tests using `pytest` to ensure everything is functioning correctly.

To run, use:

```bash
bash scripts/quick_tests.sh
```

## create_venv.sh

The `create_venv.sh` script is designed to simplify the process of creating a Python virtual environment based on a specified Python version. This script allows you to specify either an exact version (e.g., `3.8.17`) or a major and minor version (e.g., `3.8`), and it will automatically find the appropriate version installed via `pyenv`.

### Functionality

1. **Argument Handling**: The script requires one argument, which is the desired Python version. If no argument is provided, it displays usage instructions and exits.

2. **Exact Version Check**: It first checks if the exact version directory exists in the `$(PYENV_ROOT)/versions` directory. If it does, the script uses that version directly.

3. **Finding the Largest Version**: If the exact version is not found, the script searches for the largest available version that matches the specified major and minor version. It iterates through the directories in `$(PYENV_ROOT)/versions` that start with the specified version and selects the highest version based on the directory names.

4. **Creating the Virtual Environment**: Once the appropriate version is determined, the script uses the corresponding Python executable to create a virtual environment named `.venv` in the current working directory.

5. **Error Handling**: The script includes error handling to notify the user if no matching Python version is found or if the Python executable is not available.

### Usage

To use the script, run the following command in your terminal:

```
bash scripts/create_venv.sh 3.8 # to create `./.venv` virtual environment in $PWD
```

# Testing with Docker

This project includes a `Dockerfile_testing` that provides a convenient and isolated environment for building and testing the application using Docker. This ensures that the application behaves consistently across different environments and eliminates issues related to local dependencies.

## Features
- **Isolated Environment**: The Dockerfile sets up a clean environment with all necessary dependencies, ensuring that tests run in a consistent context.
- **Automated Dependency Management**: The Dockerfile uses Poetry to manage dependencies, making it easy to install the required packages without manual intervention.
- **Coverage Reporting**: The testing process includes coverage reporting, allowing you to see how much of your code is covered by tests.
- **Multi-Stage Build**: The Dockerfile employs a multi-stage build process, separating the build and runtime environments. This results in a smaller final image size by excluding unnecessary build dependencies.

## Usage
To use the `Dockerfile_testing` for testing your application, follow these steps:

1. **Build the Docker Image**:
   Run the following command in the root directory of your project to build the Docker image:
   ```bash
   docker build -f Dockerfile_testing -t testing_in_docker .
   ```

2. **Run the Tests**:
   After building the image, you can run the tests by executing:
   ```bash
   docker run --rm testing_in_docker
   ```
   This command will run the tests defined in your project, and you will see the output in your terminal.

3. **Review Coverage Reports**:
   The test run will include coverage reporting. Review the output to see which parts of your code are covered by tests and identify areas for improvement.

4. **Use Make**
   You can use `make` to automate this, simply run: `make test-in-docker`

# Good Articles and Answers

https://stackoverflow.com/questions/60073711/how-to-build-c-extensions-via-poetry
